<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - MovieTrack</title>
    <link rel="icon" href="assets/logo.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/admin-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="admin-body">
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Navigation Overlay for Mobile -->
    <div class="admin-nav-overlay" id="navOverlay" onclick="toggleMobileNav()"></div>

    <!-- Admin Navigation -->
    <nav class="admin-nav">
        <button class="mobile-sidebar-toggle" onclick="toggleMobileNav()">
            <i class="fas fa-bars"></i>
        </button>
        <div class="admin-nav-brand">
            <a href="#dashboard" class="logo-link">
                <img src="assets/logo.svg" alt="MovieTrack Logo" class="logo-svg">
                <span>MovieTrack <small>Admin</small></span>
            </a>
        </div>
        <div class="admin-nav-menu" id="adminNavMenu">
            <a href="#dashboard" class="nav-link active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="#users" class="nav-link" data-section="users">
                <i class="fas fa-users"></i> Users
            </a>
            <a href="#announcements" class="nav-link" data-section="announcements">
                <i class="fas fa-bullhorn"></i> Announcements
            </a>
            <a href="#activity" class="nav-link" data-section="activity">
                <i class="fas fa-history"></i> Activity Logs
            </a>
            <a href="#stats" class="nav-link" data-section="stats">
                <i class="fas fa-chart-bar"></i> Statistics
            </a>
        </div>
        <div class="admin-nav-user">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                <i class="fas fa-moon"></i>
            </button>
            <span id="adminName">Admin</span>
            <button class="btn-logout" onclick="adminLogout()">
                <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
            </button>
        </div>
    </nav>

    <!-- Main Admin Content -->
    <div class="admin-container">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="admin-section active">
            <div class="section-header">
                <h1><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h1>
                <div class="header-actions">
                    <div class="export-dropdown">
                        <button class="btn-export" onclick="toggleExportMenu('dashboardExport')">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                        <div class="export-menu" id="dashboardExport">
                            <button onclick="exportDashboard('pdf')">
                                <i class="fas fa-file-pdf"></i> Export as PDF
                            </button>
                            <button onclick="exportDashboard('csv')">
                                <i class="fas fa-file-csv"></i> Export as CSV
                            </button>
                            <button onclick="exportDashboard('json')">
                                <i class="fas fa-file-code"></i> Export as JSON
                            </button>
                        </div>
                    </div>
                    <button class="btn-refresh" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalUsers">0</h3>
                        <p>Total Users</p>
                        <span class="stat-change" id="userChange">+0% this month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fas fa-film"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalMovies">0</h3>
                        <p>Total Movies</p>
                        <span class="stat-change" id="movieChange">+0% this month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="activeUsers">0</h3>
                        <p>Active Users</p>
                        <span class="stat-change">Last 24 hours</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="avgMoviesPerUser">0</h3>
                        <p>Avg Movies/User</p>
                        <span class="stat-change">Platform average</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3><i class="fas fa-chart-line"></i> User Growth (Last 30 Days)</h3>
                    <canvas id="userGrowthChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3><i class="fas fa-chart-pie"></i> Movies by Genre</h3>
                    <canvas id="genreChart"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity-card">
                <h3><i class="fas fa-clock"></i> Recent Activity</h3>
                <div id="recentActivity" class="activity-list">
                    <p class="loading">Loading recent activity...</p>
                </div>
            </div>

            <!-- Recent Users -->
            <div class="recent-users-card">
                <h3><i class="fas fa-user-plus"></i> New Users</h3>
                <div id="recentUsers" class="users-list">
                    <p class="loading">Loading new users...</p>
                </div>
            </div>
        </section>

        <!-- Users Section -->
        <section id="users-section" class="admin-section">
            <!-- Bulk Action Bar -->
            <div class="bulk-action-bar" id="bulkActionBar">
                <span class="selected-count" id="selectedCount">0 users selected</span>
                <div class="bulk-action-buttons">
                    <button onclick="bulkBanUsers()">
                        <i class="fas fa-ban"></i> Ban Selected
                    </button>
                    <button onclick="bulkUnbanUsers()">
                        <i class="fas fa-check-circle"></i> Unban Selected
                    </button>
                    <button class="btn-danger" onclick="bulkDeleteUsers()">
                        <i class="fas fa-trash"></i> Delete Selected
                    </button>
                </div>
            </div>
            
            <div class="section-header">
                <h1><i class="fas fa-users"></i> User Management</h1>
                <div class="header-actions">
                    <div class="export-dropdown">
                        <button class="btn-export" onclick="toggleExportMenu('usersExport')">
                            <i class="fas fa-download"></i> Export Users
                        </button>
                        <div class="export-menu" id="usersExport">
                            <button onclick="exportUsers('csv')">
                                <i class="fas fa-file-csv"></i> Export as CSV
                            </button>
                            <button onclick="exportUsers('json')">
                                <i class="fas fa-file-code"></i> Export as JSON
                            </button>
                        </div>
                    </div>
                    <input 
                        type="text" 
                        id="userSearch" 
                        placeholder="Search users..." 
                        class="search-input">
                    <select id="userFilter" class="filter-select">
                        <option value="">All Users</option>
                        <option value="active">Active Only</option>
                        <option value="banned">Banned Only</option>
                        <option value="admin">Admins Only</option>
                    </select>
                </div>
            </div>

            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th class="checkbox-cell">
                                <input type="checkbox" id="selectAllUsers" onchange="toggleSelectAll()">
                            </th>
                            <th>User</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Movies</th>
                            <th>Joined</th>
                            <th>Last Login</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <tr>
                            <td colspan="9" class="loading">Loading users...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="usersPagination"></div>
        </section>

        <!-- Announcements Section -->
        <section id="announcements-section" class="admin-section">
            <div class="section-header">
                <h1><i class="fas fa-bullhorn"></i> Announcements</h1>
            </div>

            <div class="announcement-create-card">
                <h3><i class="fas fa-plus-circle"></i> Create New Announcement</h3>
                <form id="announcementForm" onsubmit="createAnnouncement(event)">
                    <div class="form-group">
                        <label>Announcement Title</label>
                        <input 
                            type="text" 
                            id="announcementTitle" 
                            placeholder="Enter announcement title"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label>Message</label>
                        <textarea 
                            id="announcementMessage" 
                            placeholder="Enter your message here..."
                            rows="4"
                            required
                        ></textarea>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="announcementType">
                            <option value="info">Info</option>
                            <option value="success">Success</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="announcementActive" checked>
                            Active (show to users)
                        </label>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane"></i> Broadcast Announcement
                    </button>
                </form>
            </div>

            <div class="announcements-list-card">
                <h3><i class="fas fa-list"></i> All Announcements</h3>
                <div id="announcementsList" class="announcements-list">
                    <p class="loading">Loading announcements...</p>
                </div>
            </div>
        </section>

        <!-- Activity Logs Section -->
        <section id="activity-section" class="admin-section">
            <div class="section-header">
                <h1><i class="fas fa-history"></i> Activity Logs</h1>
                <div class="header-actions">
                    <div class="export-dropdown">
                        <button class="btn-export" onclick="toggleExportMenu('activityExport')">
                            <i class="fas fa-download"></i> Export Logs
                        </button>
                        <div class="export-menu" id="activityExport">
                            <button onclick="exportActivityLogs('csv')">
                                <i class="fas fa-file-csv"></i> Export as CSV
                            </button>
                            <button onclick="exportActivityLogs('json')">
                                <i class="fas fa-file-code"></i> Export as JSON
                            </button>
                        </div>
                    </div>
                    <select id="actionFilter" class="filter-select">
                        <option value="">All Actions</option>
                        <option value="login">Login</option>
                        <option value="register">Register</option>
                        <option value="add_movie">Add Movie</option>
                        <option value="delete_movie">Delete Movie</option>
                        <option value="update_movie">Update Movie</option>
                        <option value="banned">Banned</option>
                        <option value="unbanned">Unbanned</option>
                    </select>
                    <input 
                        type="date" 
                        id="dateFilter" 
                        class="date-input">
                </div>
            </div>

            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>User</th>
                            <th>Action</th>
                            <th>Details</th>
                            <th>IP Address</th>
                        </tr>
                    </thead>
                    <tbody id="activityTableBody">
                        <tr>
                            <td colspan="5" class="loading">Loading activity logs...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="activityPagination"></div>
        </section>

        <!-- Statistics Section -->
        <section id="stats-section" class="admin-section">
            <div class="section-header">
                <h1><i class="fas fa-chart-bar"></i> Platform Statistics</h1>
            </div>

            <div class="stats-details-grid">
                <div class="stats-detail-card">
                    <h3><i class="fas fa-users"></i> Users by Status</h3>
                    <canvas id="usersStatusChart"></canvas>
                </div>

                <div class="stats-detail-card">
                    <h3><i class="fas fa-film"></i> Content Distribution</h3>
                    <canvas id="contentTypeChart"></canvas>
                </div>

                <div class="stats-detail-card">
                    <h3><i class="fas fa-star"></i> Top Genres</h3>
                    <canvas id="topGenresChart"></canvas>
                </div>

                <div class="stats-detail-card">
                    <h3><i class="fas fa-calendar-alt"></i> Daily Active Users</h3>
                    <canvas id="dailyActiveChart"></canvas>
                </div>
            </div>

            <!-- Additional Stats Tables -->
            <div class="stats-tables">
                <div class="stats-table-card">
                    <h3><i class="fas fa-trophy"></i> Most Active Users</h3>
                    <div id="topUsersTable"></div>
                </div>

                <div class="stats-table-card">
                    <h3><i class="fas fa-fire"></i> Popular Movies</h3>
                    <div id="popularMoviesTable"></div>
                </div>
            </div>
        </section>
    </div>

    <!-- User Details Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeUserModal()">&times;</span>
            <h2><i class="fas fa-user"></i> User Details</h2>
            <div id="userDetails" class="user-details-content">
                <p class="loading">Loading user details...</p>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content modal-small">
            <h3 id="confirmTitle">Confirm Action</h3>
            <p id="confirmMessage">Are you sure?</p>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn-confirm" id="confirmButton">Confirm</button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>
